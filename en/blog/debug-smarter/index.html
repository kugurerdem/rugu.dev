<html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Uğur Erdem Seyfi"><link rel=stylesheet href="/style.css?v=1724544000"><title>Debug Smarter |
rugu</title><meta property="og:url" content="https://rugu.dev/en/blog/debug-smarter/"><meta property="og:site_name" content="Uğur Erdem Seyfi"><meta property="og:title" content="Debug Smarter"><meta property="og:description" content="In this essay, I share some tips that I’ve found particularly beneficial for my own debugging experience. Hope it helps the reader as well.
If you have any cool tips you’d also like to share, feel free to share them. I might include them in the essay and give you credit for it.
Writing Logs to STDERR I’ve noticed that developers, myself included, often instinctively write debug logs to STDOUT. While this might not cause problems if the program’s output isn’t intended for other programs to consume, it becomes crucial when managing multiple scripts that depend on each other (such as when one script writes to a file that another reads)."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-08-25T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-25T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Debug Smarter"><meta name=twitter:description content="In this essay, I share some tips that I’ve found particularly beneficial for my own debugging experience. Hope it helps the reader as well.
If you have any cool tips you’d also like to share, feel free to share them. I might include them in the essay and give you credit for it.
Writing Logs to STDERR I’ve noticed that developers, myself included, often instinctively write debug logs to STDOUT. While this might not cause problems if the program’s output isn’t intended for other programs to consume, it becomes crucial when managing multiple scripts that depend on each other (such as when one script writes to a file that another reads)."><script data-goatcounter=https://stats.rugu.dev/count async src=//stats.rugu.dev/count.js></script></head><body><nav><div class=menu><a href=/en>Home </a><a href=/en/blog>Blog </a><a href=/en/about>About</a></div><div class=languages><a href=/tr>tr </a><span>| </span><a href=/en style=color:#000>en</a></div></nav><div class=master-container><article><div class=page><h1>Debug Smarter</h1><i>Written at 2024-08-25</i><hr><p>In this essay, I share some tips that I&rsquo;ve found particularly beneficial for my
own debugging experience. Hope it helps the reader as well.</p><p>If you have any cool tips you&rsquo;d also like to share, feel free to share them. I
might include them in the essay and give you credit for it.</p><h1 id=writing-logs-to-stderr>Writing Logs to STDERR</h1><p>I&rsquo;ve noticed that developers, myself included, often instinctively write debug
logs to STDOUT. While this might not cause problems if the program&rsquo;s output
isn’t intended for other programs to consume, it becomes crucial when managing
multiple scripts that depend on each other (such as when one script writes to a
file that another reads).</p><p>In these situations, if you&rsquo;re writing everything to STDOUT, you might not be
taking full advantage of the pipe and redirection mechanisms available in your
UNIX environment. The primary purpose of the STDOUT file descriptor is to
facilitate interprocess communication through mechanisms like piping. By using
STDOUT for debug logs and similar outputs, you might be accidentally
complicating your own workflow and missing out on its intended purpose.</p><p>So, what to do instead? Simply write your debug logs to STDERR instead of
STDOUT. Since both STDOUT and STDERR are displayed in your terminal, you&rsquo;ll
still see your debug logs on the terminal screen as usual.</p><p>Many common UNIX utilities already follow this practice. Run grep on a
non-existent file, you will see that the error message is sent to STDERR, while
any matching lines would be sent to STDOUT. Attempt to create a directory with
<code>mkdir</code> that already exists or run <code>cat</code> on a non-existent file, the error
messages are directed to STDERR. The same behavior can be observed with <code>curl</code>
and <code>find</code> when they encounter errors. These programs consistently write error
and debug messages to STDERR.</p><p>Simply put, if the output of your process isn’t intended for use by another
process, direct it to STDERR instead. Additionally, if you want certain errors
to be manageable by other programs, you can use EXIT CODES. This allows other
programs to decide how to handle specific error situations.</p><p>Just don&rsquo;t clutter the STDOUT.</p><h1 id=conditional-debugging>Conditional Debugging</h1><p>In NodeJS, there is this function called
<a href=https://nodejs.org/docs/latest/api/util.html#utildebuglogsection-callback>debuglog</a>
under the default util module.</p><p>What it does is to return you a debug function that conditionally logs to
STDERR, based on the value of <code>NODE_DEBUG</code> env variable.</p><p>To give you an example, consider the following file <code>debug.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span>
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>debuglog</span>} <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;util&#39;</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>normalLog</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>debuglog</span>(<span style=color:#e6db74>&#39;normal&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>verboseLog</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>debuglog</span>(<span style=color:#e6db74>&#39;verbose&#39;</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>main</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>normalLog</span>(<span style=color:#e6db74>&#39;This is a normal log!&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>verboseLog</span>(<span style=color:#e6db74>&#39;This is a more specific, detailed log!&#39;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>main</span>()
</span></span></code></pre></div><p>Now, on your shell, try running <code>node debug.js</code>, you won&rsquo;t get any results
printed to terminal.</p><p>Now, try it like <code>NODE_DEBUG=normal node debug.js</code>;</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ NODE_DEBUG=normal node debug.js
NORMAL 16231: This is a normal log!
</code></pre><p>Now, try it like <code>NODE_DEBUG=normal,verbose node debug.js</code>;</p><pre tabindex=0><code class=language-terminal data-lang=terminal>$ `NODE_DEBUG=normal,verbose node debug.js`;
NORMAL 16337: This is a normal log!
VERBOSE 16337: This is a more specific, detailed log!
</code></pre><p>I hope you see the value of this approach. By adjusting the value of the
<code>NODE_DEBUG</code> environment variable, you can control the level of detail you want
to see in your debug logs. You can also have different debug logs for unrelated
parts of the code so that you can seperate unrelated logs from each other. What
I generally like to do is to have different debug logs for different modules.</p><p>This way, you can have more control over your debug logs so that they don&rsquo;t
clutter the STDERR much. You can, for example, choose to disable/enable certain
kind of debug logs depending on what you really want to see at that moment.</p><p>The good thing is that the way <code>debuglog</code> works under the hood is pretty
straightforward, (see <a href=https://github.com/nodejs/node/blob/43f699d4d2799cfc17cbcad5770e1889075d5dbe/lib/internal/util/debuglog.js#L87>source
code</a>).</p><p>If it already doesn&rsquo;n exist, you can easily implement a similar mechanism in
your favorite language (as long as it supports higher-order functions). Feel
free to translate the following custom JavaScript code I wrote (for
demonstration purposes) into the language of your choice.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>debuglog</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>logName</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>logNames</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>NODE_DEBUG</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;,&#39;</span>) <span style=color:#f92672>||</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>logNames</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>logName</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>log</span> =&gt; <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>stderr</span>.<span style=color:#a6e22e>write</span>(<span style=color:#e6db74>`[</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>logName</span><span style=color:#e6db74>}</span><span style=color:#e6db74>] </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>log</span><span style=color:#e6db74>}</span><span style=color:#e6db74>\n`</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> () =&gt; {} <span style=color:#75715e>// noop
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=tap-functions>Tap Functions</h1><p>A tap function is a function that returns the value it receives while executing
specific side effects. It is commonly used for logging, particularly for
intermediate values, without requiring significant code refactoring.</p><p>Let me show you how it looks. Consider the following piece of code I came up
with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>f1</span>(<span style=color:#a6e22e>f2</span>(<span style=color:#a6e22e>f3</span>( ...<span style=color:#a6e22e>someArgs</span>)))
</span></span></code></pre></div><p>Say you want to see what the function <code>f3</code> returns in your debug logs. What
would you do?</p><p>If you were to write something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>f3Result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>f3</span>(...<span style=color:#a6e22e>someArgs</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>f3Result</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>f1</span>(<span style=color:#a6e22e>f2</span>(<span style=color:#a6e22e>f3Result</span>)
</span></span></code></pre></div><p>You can probably understand the frustration that comes with this approach.
However, tap functions let you do something like this instead:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>f1</span>(<span style=color:#a6e22e>f2</span>(<span style=color:#a6e22e>taplog</span>(<span style=color:#a6e22e>f3</span>( ...<span style=color:#a6e22e>someArgs</span>))))
</span></span></code></pre></div><p>As you can see, we simply wrapped the <code>f3</code> function call with <code>taplog</code>. This
approach requires much less effort and is especially helpful when you need to
quickly log an argument passed to another function (in this case, the result of
<code>f3</code> being passed to <code>f2</code>) without altering the code structure much.</p><p>I find tap functions particularly helpful when working with frameworks like
<code>React</code>, where you occasionally pass expressions as arguments to other components
and want to log those expressions without disrupting the code flow.</p><p>What I like is to create a generic function for creating tap functions, called
<code>tap</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tap</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fn</span> =&gt; (<span style=color:#a6e22e>value</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fn</span>(<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And then use it to create your specific tap functions based on your needs.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span>
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>debuglog</span>} <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;util&#39;</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>debug</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>debuglog</span>(<span style=color:#e6db74>&#39;blabla&#39;</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tapDebug</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tap</span>(<span style=color:#a6e22e>debug</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tapLog</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tap</span>(<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tapErr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tap</span>(<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tapAll</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tap</span>((<span style=color:#a6e22e>val</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tapDebug</span>(<span style=color:#a6e22e>val</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tapLog</span>(<span style=color:#a6e22e>val</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tapErr</span>(<span style=color:#a6e22e>val</span>)
</span></span><span style=display:flex><span>    })
</span></span></code></pre></div><p>These are just example functions, but the main idea here is that you can
basically create your own tap functions for your own needs.</p></div></article><aside class=side><img class=author-image src=/ugur_img.jpg><hr><center><b>Uğur Erdem Seyfi</b></center><hr><div class=icon-container><a href=https://www.linkedin.com/in/ugur-erdem-seyfi target=_blank><img class="icon hover" src=/icons/linkedin.svg>
</a><a href=https://github.com/kugurerdem target=_blank><img class="icon hover" src=/icons/github.svg>
</a><a href="https://news.ycombinator.com/user?id=kugurerdem" target=_blank><img class="icon hover" src=/icons/hackernews.svg>
</a><a href=https://twitter.com/kugurerdem target=_blank><img class="icon hover" src=/icons/twitter.svg>
</a><a href=/en/index.xml target=_blank><img class="icon hover" src=/icons/rss.svg></a></div><hr><div>a software developer with a hacker's attitude, interested in philosophy and psychology</div><hr>Contact: <a href=mailto:ugur@rugu.dev>ugur@rugu.dev</a><hr><button class=newsletter-btn onclick='window.open("https://listmonk.rugu.dev/subscription/form","_blank")'>
Subscribe to Newsletter
</button>
<a class="source icon-container hover" href=https://github.com/kugurerdem/rugudev target=_blank><img class=icon src=/icons/git.svg>
Source Code</a></aside></div></body><html>